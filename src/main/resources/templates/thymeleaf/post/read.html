<!DOCTYPE html>
<html lang="en" xmlns:tb="http://www.w3.org/1999/xhtml">
<head>
    <script src="https://unpkg.com/htmx.org@1.8.6"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS ë§í¬ ì¶”ê°€ -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h3>ì œëª© :</h3>
    <div th:text="${post.getTitle()}"></div>
    <h3>ìœ ì € ì•„ì´ë”” :</h3>
    <div th:text="${post.getUser().getUserId()}"></div>
    <h3>ì‹œê°„ :</h3>
    <div th:text="${post.getTime()}"></div>
    <h3>ê²Œì‹œê¸€ì˜ ì¢…ë¥˜:</h3>
    <div th:text="${post.getPostCategory().getName()}"></div>
    <h3>ì´ë¯¸ì§€ :</h3>
    <img th:src="${post.getImagePath()}" class="img-fluid">
    <h3>ë‚´ìš© :</h3>
    <div th:text="${post.getContent()}"></div>

    <a th:href="@{/post/delete(postId=${post.getId()})}" class="btn btn-danger">ì‚­ì œ</a>
    <a th:href="@{/post/update(postId=${post.getId()})}" class="btn btn-primary">ìˆ˜ì •</a>

    <hr>

    <h3>ê²Œì‹œê¸€ ë¦¬ë·°</h3>
    <a th:href="@{/post/read(reviewLink=true,postId=${post.getId()})}" class="btn btn-info">ë¦¬ë·° ì‘ì„±</a>
    <div th:if="${reviewLink}">
        <form th:action="@{/post/review/add}" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="title">ì œëª©</label>
                <input type="text" name="title" id="title" class="form-control">
            </div>
            <div class="form-group">
                <label for="content">ë‚´ìš©</label>
                <input type="text" name="content" id="content" class="form-control">
            </div>
            <div class="form-group">
                <label for="file">ì´ë¯¸ì§€</label>
                <input type="file" name="file" id="file" accept="image/*" class="form-control-file">
            </div>
            <input type="hidden" name="kinds" value="PostReview">
            <input type="hidden" name="kindsId" th:value="${post.getId()}">
            <input type="submit" value="ì‘ì„±" class="btn btn-success">
        </form>
    </div>
    <div th:each="reviewList:${postReviewList}">
        <h4>ì œëª© :</h4>
        <div th:text="${reviewList.getTitle()}"></div>
        <h4>ìœ ì € ì•„ì´ë””:</h4>
        <div th:text="${reviewList.getUser().getUserId()}"></div>
        <h4>ì‹œê°„:</h4>
        <div th:text="${reviewList.getTime()}"></div>
        <h4>ì´ë¯¸ì§€ :</h4>
        <img th:src="${reviewList.getImagePath()}" class="img-fluid">
        <h4>ë‚´ìš© :</h4>
        <div th:text="${reviewList.getContent()}"></div>
        <!--    id result ê°’ì´ "Best" ì¼ë•Œ-->
        <div th:if="${recommendList==null}">
            <form th:action="@{/review/recommend}" method="post">
                <input type="hidden" name="baseReviewId" th:value="${reviewList.getId()}">
                <input type="hidden" name="trueOrFalse" th:value="BEST">
                <input type="submit" value="ğŸ‘">
            </form>
            <form th:action="@{/review/recommend}" method="post">
                <input type="hidden" name="baseReviewId" th:value="${reviewList.getId()}">
                <input type="hidden" name="trueOrFalse" th:value="WORST">
                <input type="submit" value="ğŸ‘">
            </form>
        </div>
        <div th:id="recommendInfo" th:hx-get="@{/post/read/{reviewId}(reviewId=${reviewList.getId()})}"
             hx-trigger="load"
             th:data-reviewId="${reviewList.getId()}">
        </div>

        <a th:href="@{/post/review/delete(reviewId=${reviewList.getId()})}" class="btn btn-danger">ì‚­ì œ</a>
        <a th:href="@{/post/review/update(reviewId=${reviewList.getId()})}" class="btn btn-primary">ìˆ˜ì •</a>
        <hr>
    </div>

    <script>
        // ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ URL
        var reviewId = document.getElementById('recommendInfo').getAttribute('data-reviewId');
        var url = '/post/read/' + reviewId; // reviewIdì— ì‹¤ì œ ë¦¬ë·° ì•„ì´ë””ë¥¼ ëŒ€ì…í•´ì•¼ í•¨

        // GET ìš”ì²­ì„ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
        fetch(url)
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                // ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ HTML ìš”ì†Œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±
                var recommendInfo = document.getElementById('recommendInfo');
                var html = '';

                // recommend ê°’ì— ë”°ë¼ HTMLì„ ë™ì ìœ¼ë¡œ ìƒì„±
                if (data.recommend === 'Best') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="CANCEL">' +
                        '<input type="submit" value="ğŸ‘" style="background-color: blue" >' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="WORST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                } else if (data.recommend === 'Worst') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="BEST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="CANCEL">' +
                        '<input type="submit" value="ğŸ‘" style="background-color: red" >' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                } else if (data.recommend === 'Cancel') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="BEST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="WORST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                }

                // ìƒì„±í•œ HTMLì„ ìš”ì†Œì— í• ë‹¹
                recommendInfo.innerHTML = html;
            })
            .catch(function (error) {
                console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
            });
    </script>
</div>
</body>
</html>