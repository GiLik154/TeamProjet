<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Product User Detail</title>
    <link rel="stylesheet" href="/static/css/productUserDetail.css">
    <script src="https://unpkg.com/htmx.org@latest/dist/htmx.js"></script>
</head>

<body>

<div class="container">
    <div class="image">
        <img th:src="${productDetail.get().getImage()}" alt="Product Image">
    </div>

    <div class="product-info">
        <table>
            <tr>
                <th>ì´ë¦„</th>
                <td th:text="${productDetail.get().getName()}"></td>
            </tr>
            <tr>
                <th>ê°€ê²©</th>
                <!--  <td th:text="${productDetail.get().getPrice()}"></td> -->
                <td><span th:text="${#numbers.formatInteger(productDetail.get().getPrice(), 3, 'COMMA')}"></span> ì›</td>
            </tr>
            <tr>
                <th>ì„¤ëª…</th>
                <td th:text="${productDetail.get().getDescription()}"></td>
            </tr>
            <tr>
                <th>ì¬ê³ </th>
                <td th:text="${productDetail.get().getStock()}"></td>
            </tr>

        </table>

        <form th:action="@{/order/create/{productId}(productId=${productId})}">
            ìˆ˜ëŸ‰ :&nbsp;&nbsp;<input type="number" name="salesCount" min="1" max="100"
                                   style="width: 35px;height: 35px; border-radius: 9px; border-style: double" value="1">
            <button type="submit">êµ¬ë§¤í•˜ê¸°</button>
        </form>

        <form th:action="@{/update/like}">
            <input type="hidden" name="productId" th:value="${productId}">
            <button type="submit">
                <span th:if="${isLiked}">â¤ï¸</span>
                <span th:if="${!isLiked}">ğŸ–¤</span>
            </button>
        </form>

        <table>
            <tr>
                <th>ì œëª©</th>
                <th>ë‚´ìš©</th>
                <th>ì‚¬ì§„</th>
                <th>ìœ ì €</th>
                <th>ì‹œê°„</th>
                <a th:href="@{/product/review/add(productId=${productDetail.get().getId()})}">ì‘ì„±</a>
            </tr>
            <tr th:each="productReview:${productReviewList}">
                <td th:text="${productReview.getTitle()}"></td>
                <td th:text="${productReview.getContent()}"></td>
                <td><img th:src="${productReview.getImagePath()}"></td>
                <td th:text="${productReview.getUser().getUserId()}"></td>
                <td th:text="${productReview.getTime()}"></td>
                <td>
                    <a th:href="@{/product/review/delete(reviewId=${productReview.getId()})}">ì‚­ì œ</a>
                    <a th:href="@{/product/review/update(reviewId=${productReview.getId()})}">ìˆ˜ì •</a>
                </td>
                <td th:id="recommendInfo"
                    th:hx-get="@{/product/detail/reviewId/{reviewId}(reviewId=${productReview.getId()})}"
                    hx-trigger="load"
                    th:data-reviewId="${productReview.getId()}">
                </td>
            </tr>
        </table>

        <div class="pagination">
            <div th:if="${startPage != 1}">
                <a th:href="@{/product/detail/{productId}(productId=${productDetail.get().getId()},page=${startPage - limitPage})}">
                    ì´ì „
                </a>
            </div>
            <div th:each="page:${#numbers.sequence(startPage, endPage)}">
        <span th:if="${page} == ${productReviewList.getNumber() + 1}">
            <span th:text="${page}">í˜ì´ì§€</span>
        </span>
                <a th:if="${page != productReviewList.getNumber() + 1 && page <= productReviewList.getTotalPages()}"
                   th:href="@{/product/detail/{productId}(productId=${productDetail.get().getId()},page=${page})}">
                    <span th:text="${page}">í˜ì´ì§€</span>
                </a>
            </div>
            <div th:if="${endPage < productReviewList.totalPages}">
                <a th:href="@{/product/detail/{productId}(productId=${productDetail.get().getId()},page=${startPage + limitPage})}">
                    ë‹¤ìŒ
                </a>
            </div>
        </div>

    </div>

    <script>
        // ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ URL
        var reviewId = document.getElementById('recommendInfo').getAttribute('data-reviewId');
        var url = '/post/read/' + reviewId; // reviewIdì— ì‹¤ì œ ë¦¬ë·° ì•„ì´ë””ë¥¼ ëŒ€ì…í•´ì•¼ í•¨

        // GET ìš”ì²­ì„ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
        fetch(url)
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                // ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ HTML ìš”ì†Œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±
                var recommendInfo = document.getElementById('recommendInfo');
                var html = '';

                // recommend ê°’ì— ë”°ë¼ HTMLì„ ë™ì ìœ¼ë¡œ ìƒì„±
                if (data.recommend === 'Best') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="CANCEL">' +
                        '<input type="submit" value="ğŸ‘" style="background-color: blue" >' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="WORST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                } else if (data.recommend === 'Worst') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="BEST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="CANCEL">' +
                        '<input type="submit" value="ğŸ‘" style="background-color: red" >' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                } else if (data.recommend === 'Cancel') {
                    html = '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" id="baseReviewId" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" id="trueOrFalse" name="trueOrFalse" value="BEST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<form action="/review/recommend" method="post">' +
                        '<input type="hidden" name="baseReviewId" value="' + reviewId + '">' +
                        '<input type="hidden" name="trueOrFalse" value="WORST">' +
                        '<input type="submit" value="ğŸ‘">' +
                        '</form>' +
                        '<p>ì¶”ì²œìˆ˜:' + data.recommendBestCount + '</p>' +
                        '<p>ë¹„ì¶”ì²œìˆ˜:' + data.recommendWorstCount + '</p>';
                }

                // ìƒì„±í•œ HTMLì„ ìš”ì†Œì— í• ë‹¹
                recommendInfo.innerHTML = html;
            })
            .catch(function (error) {
                console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
            });
    </script>
</div>

</body>

</html>